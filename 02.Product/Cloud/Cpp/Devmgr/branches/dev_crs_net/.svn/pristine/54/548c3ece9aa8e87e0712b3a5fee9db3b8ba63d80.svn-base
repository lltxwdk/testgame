
#ifndef LIST_COMPLINCENE_H
#define LIST_COMPLINCENE_H

#include <iostream>
#include <set>
#include "DBconnector.h"

using namespace std;

struct sCompLinceneInfo
{
	int srcnt;							//基础并发-点数
	std::string srstarttime;			//基础并发-授权开始时间
	std::string srexptime;				//基础并发-授权截止时间
	int stdcnt;							//标准终端-点数
	std::string	stdstarttime;			//标准终端-授权开始时间
	std::string stdexptime;				//标准终端-授权截止时间
	int monitorcnt;						//监控(包含监控实时流,监控录像)-点数
	std::string	monitorstarttime;		//监控-授权开始时间
	std::string monitorexptime;			//监控-授权截止时间
	int voicecnt;						//语音(包含PSTN)-点数
	std::string	voicestarttime;			//语音(包含PSTN)-授权开始时间
	std::string voiceexptime;			//语音(包含PSTN)-授权截止时间
	int reccnt;							//录播-点数
	std::string	recstarttime;			//录播-授权开始时间
	std::string recexptime;				//录播-授权截止时间
	int livecnt;						//直播-点数
	std::string	livestarttime;			//直播-授权开始时间
	std::string	liveexptime;			//直播-授权截止时间
	int confcnt;						//每个企业限定最大会议数
	
	sCompLinceneInfo()
	{
		srcnt = 0;
		srexptime = "";
		srstarttime = "";
		stdcnt = 0;
		stdexptime = "";
		stdstarttime = "";
		monitorcnt = 0;
		monitorexptime = "";
		monitorstarttime = "";
		voicecnt = 0;
		voiceexptime = "";
		voicestarttime = "";
		reccnt = 0;
		recexptime = "";
		recstarttime = "";
		livecnt = 0;
		liveexptime = "";
		livestarttime = "";
		confcnt = 0;

	}

};

struct sLinceneInfo
{
	//int type;							//授权类型
	int amount;							//授权点数
	std::string starttime;				//授权开始时间
	std::string expiretime;				//授权截止时间
};

class CCompCapLincene
{
public:
	CCompCapLincene();
	virtual ~CCompCapLincene();
	//static CDeviceConfig* GetInstance();

	bool GetCompLinceneInfo(int compid, map<std::string, sLinceneInfo>& linceneInfo);

	std::set<int> GetCompIdList();

	bool SelectSingleCompLinceneInfo(int compid, map<std::string, sLinceneInfo>& linceneInfo);
	//
	bool InsertDB();
	bool DeleteDB();
	bool UpdateDB();
	bool SelectLinceneIdDB();
	bool SelectCompLinceneDB();

private:
	int m_compid;							//企业id
 
	//t_capbility表对应值,key-capid,value-col_ab

	std::map<int, string> mapCapbilityInfo;

	/////
	std::map<int, sCompLinceneInfo>m_smapCompLinceneInfo;

	//企业授权信息,key-compid,value-map, keys-capid,value-sLinceneInfo
	std::map<int, map<std::string, sLinceneInfo> > m_mapCompLinceneInfo;

	//企业授权capid与redis 映射表
	std::map<int, std::string>mapCompCapRedisTable;

	//所有可用的企业id
	std::set<int> m_sCompId;

	CCriticalSection m_csCCompLincene;
};

#endif //LIST_DEVICECONFIG_H